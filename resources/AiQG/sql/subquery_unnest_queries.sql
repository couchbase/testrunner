SELECT h.name, h.city, (SELECT AVG(r.ratings.Overall) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_overall_rating FROM hotel h UNNEST h.room_types AS rt WHERE h.free_parking = TRUE AND rt.availability > 0;
SELECT u.username, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.user_id = u.user_id AND b.payment_status = 'Paid') AS total_paid_bookings FROM users u UNNEST (SELECT RAW b.hotel_id FROM bookings b WHERE b.user_id = u.user_id) AS user_hotels WHERE u.city = 'New York';
SELECT h.name, (SELECT SUM(r.ratings.Cleanliness) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS total_cleanliness_rating FROM hotel h UNNEST h.amenities AS a WHERE h.city = 'New York' AND a = 'Free WiFi';
SELECT h.hotel_id, COUNT(*) AS total_availability FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0 GROUP BY h.hotel_id;
SELECT b.booking_id, (SELECT r.comments FROM reviews r WHERE r.user_id = b.user_id LIMIT 1) AS last_review_comments FROM bookings b UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = b.user_id) AS review_hotels WHERE b.payment_status = 'Paid';
SELECT h.hotel_id, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS total_reviews FROM hotel h UNNEST h.room_types AS rt WHERE rt.price < 200;
SELECT b.booking_id, b.total_price, (SELECT r.ratings.Overall FROM reviews r WHERE r.user_id = b.user_id AND r.hotel_id = b.hotel_id LIMIT 1) AS overall_rating FROM bookings b UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS booked_rooms WHERE b.payment_status = 'Paid';
SELECT h.name, h.type, (SELECT MAX(r.ratings.Rooms) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS max_room_rating FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 5;
SELECT u.username, (SELECT SUM(b.room_count) FROM bookings b WHERE b.user_id = u.user_id) AS total_rooms_booked FROM users u UNNEST (SELECT RAW h.hotel_id FROM hotel h WHERE h.city = u.city) AS city_hotels WHERE u.country = 'USA';
SELECT b.booking_id, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.user_id = b.user_id) AS total_user_reviews FROM bookings b UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS booking_room_type WHERE b.total_price > 500;
SELECT h.city, (SELECT MAX(rt.price) FROM hotel h2 UNNEST h2.room_types AS rt WHERE h2.city = h.city) AS most_expensive_room FROM hotel h UNNEST h.amenities AS a WHERE a = 'Pool';
SELECT u.name, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.user_id = u.user_id AND b.room_type = 'Single') AS single_room_bookings FROM users u UNNEST (SELECT RAW h.hotel_id FROM hotel h WHERE h.city = u.city) AS city_hotels WHERE u.city = 'New York';
SELECT h.name, h.rating, (SELECT AVG(r.ratings.Rooms) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_room_rating FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, (SELECT r.user_id FROM reviews r WHERE r.user_id = b.user_id LIMIT 1) AS review_user FROM bookings b UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS booked_room WHERE b.payment_method = 'Credit Card';
SELECT h.hotel_id, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS num_reviews FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 5;
SELECT u.name, (SELECT MAX(b.total_price) FROM bookings b WHERE b.user_id = u.user_id AND b.payment_status = 'Paid') AS highest_paid_booking FROM users u UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = u.user_id) AS reviewed_hotels WHERE u.country = 'USA';
SELECT h.name, (SELECT COUNT(rt) FROM hotel h2 UNNEST h2.room_types AS rt WHERE h2.hotel_id = h.hotel_id AND rt.availability > 0) AS available_room_types_count FROM hotel h UNNEST h.amenities AS a WHERE a = 'Gym';
SELECT b.payment_method, (SELECT COUNT(*) FROM bookings b2 WHERE b2.user_id = b.user_id AND b2.payment_method = b.payment_method) AS method_usage FROM bookings b UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS room_types WHERE b.payment_status = 'Paid';
SELECT u.name, (SELECT SUM(b.room_count) FROM bookings b WHERE b.user_id = u.user_id AND b.hotel_id IN (SELECT RAW h.hotel_id FROM hotel h WHERE h.country = u.country)) AS rooms_booked_within_country FROM users u UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = u.user_id) AS user_reviewed_hotels WHERE u.city = 'New York';
SELECT h.name, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS reviews_count FROM hotel h UNNEST h.amenities AS a WHERE a = 'Free WiFi';
SELECT b.booking_id, (SELECT MAX(rt.price) FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS max_room_price FROM bookings b UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = b.user_id) AS user_reviewed_hotels WHERE b.user_id = 'user123';
SELECT h.address, (SELECT AVG(r.ratings.Cleanliness) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_cleanliness_rating FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT u.username, (SELECT MIN(b.checkin) FROM bookings b WHERE b.user_id = u.user_id) AS earliest_checkin FROM users u UNNEST (SELECT RAW h.city FROM hotel h WHERE h.hotel_id IN (SELECT RAW b.hotel_id FROM bookings b WHERE b.user_id = u.user_id)) AS booking_cities WHERE u.country = 'USA';
SELECT h.name, h.room_types, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS review_count FROM hotel h UNNEST h.room_types AS rt WHERE rt.price < 150;
SELECT b.booking_id, b.room_type, (SELECT r.comments FROM reviews r WHERE r.user_id = b.user_id AND r.hotel_id = b.hotel_id LIMIT 1) AS review_comments FROM bookings b UNNEST (SELECT RAW a FROM hotel h UNNEST h.amenities AS a WHERE h.hotel_id = b.hotel_id) AS amenities WHERE b.payment_status = 'Paid';
SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS booking_count FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 2;
SELECT u.name, u.email, (SELECT MAX(b.total_price) FROM bookings b WHERE b.user_id = u.user_id) AS max_booking_price FROM users u UNNEST (SELECT RAW h.city FROM hotel h WHERE h.hotel_id IN (SELECT RAW b.hotel_id FROM bookings b WHERE b.user_id = u.user_id)) AS user_hotels WHERE u.city = 'New York';
SELECT h.name, (SELECT MIN(r.ratings.Overall) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS min_overall FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, (SELECT r.ratings.Rooms FROM reviews r WHERE r.user_id = b.user_id AND r.hotel_id = b.hotel_id LIMIT 1) AS room_rating FROM bookings b UNNEST (SELECT RAW a FROM hotel h UNNEST h.amenities AS a WHERE h.hotel_id = b.hotel_id) AS amenities WHERE b.payment_status = 'Pending';
SELECT h.name, h.reviews, (SELECT SUM(b.room_count) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS total_rooms_booked FROM hotel h UNNEST h.room_types AS rt WHERE rt.price > 100;
SELECT u.username, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.user_id = u.user_id) AS total_bookings FROM users u UNNEST (SELECT RAW r.ratings.Overall FROM reviews r WHERE r.user_id = u.user_id) AS user_ratings WHERE u.city = 'New York';
SELECT h.hotel_id, (SELECT AVG(r.ratings.Cleanliness) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_cleanliness FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, b.user_id, (SELECT COUNT(h.hotel_id) FROM hotel h WHERE h.city = (SELECT u.city FROM users u WHERE u.user_id = b.user_id LIMIT 1)) AS hotels_in_user_city FROM bookings b UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = b.user_id) AS user_review_hotels WHERE b.payment_status = 'Paid';
SELECT u.name, (SELECT MIN(b.checkin) FROM bookings b WHERE b.user_id = u.user_id AND b.payment_status = 'Paid') AS next_checkin FROM users u UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = u.user_id) AS user_hotels WHERE u.country = 'USA';
SELECT h.hotel_id, (SELECT SUM(b.total_price) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS total_earnings FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, (SELECT MAX(r.review_date) FROM reviews r WHERE r.hotel_id = b.hotel_id AND r.user_id = b.user_id) AS latest_review_date FROM bookings b UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS booked_room WHERE b.payment_status = 'Paid';
SELECT h.reviews, (SELECT MIN(rt.price) FROM hotel h2 UNNEST h2.room_types AS rt WHERE h2.hotel_id = h.hotel_id) AS min_price FROM hotel h UNNEST h.amenities AS a WHERE a = 'Free Parking';
SELECT b.user_id, b.booking_id, (SELECT AVG(r.ratings.Overall) FROM reviews r WHERE r.user_id = b.user_id) AS avg_overall FROM bookings b UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS booking_rooms WHERE b.payment_status = 'Paid';
SELECT h.hotel_id, (SELECT COUNT(rt.name) FROM hotel h2 UNNEST h2.room_types AS rt WHERE h2.hotel_id = h.hotel_id AND rt.availability > 0) AS available_room_count FROM hotel h UNNEST h.amenities AS a WHERE a = 'Gym';
SELECT u.username, (SELECT SUM(b.total_price) FROM bookings b WHERE b.user_id = u.user_id) AS total_spent FROM users u UNNEST (SELECT RAW h.hotel_id FROM hotel h WHERE h.city = u.city) AS user_city_hotels WHERE u.city = 'New York';
SELECT h.name, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS review_count FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, (SELECT MAX(rt.availability) FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS max_availability FROM bookings b UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = b.user_id) AS user_reviewed_hotels WHERE b.payment_status = 'Pending';
SELECT h.name, h.city, (SELECT AVG(r.ratings.Cleanliness) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_cleanliness_rating FROM hotel h UNNEST h.amenities AS a WHERE a = 'Pool';
SELECT b.booking_id, b.checkin, (SELECT COUNT(rt.name) FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id AND rt.availability > 0) AS available_rooms FROM bookings b UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = b.user_id) AS reviewed_hotels WHERE b.payment_status = 'Paid';
SELECT h.name, h.rooms, (SELECT SUM(b.room_count) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS total_booked_rooms FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT u.email, (SELECT MIN(b.total_price) FROM bookings b WHERE b.user_id = u.user_id) AS cheapest_booking FROM users u UNNEST (SELECT RAW h.hotel_id FROM hotel h WHERE h.country = u.country) AS user_hotels WHERE u.city = 'New York';
SELECT h.name, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS total_reviews FROM hotel h UNNEST h.room_types AS rt WHERE rt.price > 150;
SELECT b.booking_id, (SELECT MAX(r.ratings.Overall) FROM reviews r WHERE r.user_id = b.user_id) AS highest_overall FROM bookings b UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS room_types WHERE b.payment_status = 'Paid';
SELECT h.hotel_id, (SELECT COUNT(rt) FROM hotel h2 UNNEST h2.room_types AS rt WHERE h2.hotel_id = h.hotel_id AND rt.availability > 0) AS available_room_count FROM hotel h UNNEST h.amenities AS a WHERE a = 'Free WiFi';
SELECT u.name, (SELECT COUNT(b) FROM bookings b WHERE b.user_id = u.user_id) AS booking_count FROM users u UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = u.user_id) AS reviewed_hotels WHERE u.city = 'New York';
SELECT h.name, (SELECT MIN(r.ratings.Rooms) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS min_room_rating FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, (SELECT COUNT(rt.name) FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS total_room_types FROM bookings b UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = b.user_id) AS user_reviewed_hotels WHERE b.payment_status = 'Paid';
SELECT h.hotel_id, COUNT(*) AS available_room_type_count FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0 GROUP BY h.hotel_id;
SELECT u.username, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.user_id = u.user_id) AS total_reviews FROM users u UNNEST (SELECT RAW b.hotel_id FROM bookings b WHERE b.user_id = u.user_id) AS user_booked_hotels WHERE u.city = 'New York';
SELECT b.booking_id, b.checkin, (SELECT COUNT(h.hotel_id) FROM hotel h WHERE h.hotel_id = b.hotel_id AND h.city = (SELECT u.city FROM users u WHERE u.user_id = b.user_id LIMIT 1)) AS hotels_in_user_city FROM bookings b UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = b.user_id) AS user_reviewed_hotels WHERE b.payment_status = 'Paid';
SELECT u.name, (SELECT SUM(b.total_price) FROM bookings b WHERE b.user_id = u.user_id AND b.payment_status = 'Pending') AS total_pending_payment FROM users u UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = u.user_id) AS reviewed_hotels WHERE u.city = 'New York';
SELECT h.hotel_id, (SELECT COUNT(rt) FROM hotel h2 UNNEST h2.room_types AS rt WHERE h2.hotel_id = h.hotel_id AND rt.availability > 0) AS available_room_count FROM hotel h UNNEST h.amenities AS a WHERE a = 'Gym';
SELECT u.username, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.user_id = u.user_id AND b.payment_status = 'Pending') AS pending_bookings FROM users u UNNEST (SELECT RAW r.ratings.Overall FROM reviews r WHERE r.user_id = u.user_id) AS user_reviews WHERE u.country = 'USA';
SELECT h.name, (SELECT MIN(r.ratings.Cleanliness) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS min_cleanliness FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, b.total_price, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.user_id = b.user_id) AS total_reviews_by_user FROM bookings b UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS booked_room WHERE b.payment_status = 'Paid';
SELECT h.name, h.city, (SELECT AVG(r.ratings.Rooms) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_room_rating FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, (SELECT MAX(rt.availability) FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS max_room_availability FROM bookings b UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = b.user_id) AS user_reviewed_hotels WHERE b.payment_status = 'Pending';
SELECT u.username, (SELECT MIN(b.total_price) FROM bookings b WHERE b.user_id = u.user_id) AS min_booking_price FROM users u UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = (SELECT RAW b.hotel_id FROM bookings b WHERE b.user_id = u.user_id LIMIT 1)) AS room_types WHERE u.country = 'USA';
SELECT h.hotel_id, (SELECT COUNT(b.booking_id) FROM bookings b WHERE b.hotel_id = h.hotel_id) AS booking_count FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT h.name, (SELECT MIN(r.ratings.Rooms) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS min_room_rating FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, (SELECT COUNT(rt.name) FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id AND rt.availability > 0) AS available_room_count FROM bookings b UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = b.user_id) AS reviewed_hotels WHERE b.payment_status = 'Paid';
SELECT h.hotel_id, COUNT(*) AS available_room_types_count FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0 GROUP BY h.hotel_id;
SELECT u.username, (SELECT COUNT(r.review_id) FROM reviews r WHERE r.user_id = u.user_id) AS total_reviews FROM users u UNNEST (SELECT RAW b.hotel_id FROM bookings b WHERE b.user_id = u.user_id) AS user_booked_hotels WHERE u.city = 'New York';
SELECT b.booking_id, b.checkin, (SELECT COUNT(h.hotel_id) FROM hotel h WHERE h.hotel_id = b.hotel_id AND h.city = (SELECT u.city FROM users u WHERE u.user_id = b.user_id LIMIT 1)) AS hotels_in_user_city FROM bookings b UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = b.user_id) AS user_reviewed_hotels WHERE b.payment_status = 'Paid';
SELECT u.name, (SELECT SUM(b.total_price) FROM bookings b WHERE b.user_id = u.user_id AND b.payment_status = 'Pending') AS total_pending_payment FROM users u UNNEST (SELECT RAW r.hotel_id FROM reviews r WHERE r.user_id = u.user_id) AS reviewed_hotels WHERE u.city = 'New York';
SELECT h.name, (SELECT COUNT(rt.name) FROM hotel h2 UNNEST h2.room_types AS rt WHERE h2.hotel_id = h.hotel_id AND rt.availability > 0) AS available_room_types_count FROM hotel h UNNEST h.amenities AS a WHERE a = 'Gym';
SELECT h.name, (SELECT AVG(r.ratings.`Check in / front desk`) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_checkin_rating FROM hotel h UNNEST h.amenities AS a WHERE h.country = 'USA' AND a = 'Gym';
SELECT h.name, (SELECT MIN(r.`ratings`.`Value`) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS min_value_rating FROM hotel h UNNEST h.room_types AS rt WHERE rt.price > 150;
SELECT h.geo, (SELECT AVG(r.`ratings`.`Value`) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS avg_value_rating FROM hotel h UNNEST h.room_types AS rt WHERE rt.price > 100;
SELECT h.name, (SELECT COUNT(rt2.name) FROM hotel h2 UNNEST h2.room_types AS rt2 WHERE h2.hotel_id = h.hotel_id AND rt2.availability > 0) AS available_rooms FROM hotel h UNNEST h.room_types AS rt WHERE rt.price < 100;
SELECT h.name, (SELECT MAX(r.ratings.`Check in / front desk`) FROM reviews r WHERE r.hotel_id = h.hotel_id) AS max_checkin_rating FROM hotel h UNNEST h.room_types AS rt WHERE rt.price < 150;
SELECT h.name, (SELECT SUM(rt_inner.availability) FROM hotel h2 UNNEST h2.room_types AS rt_inner WHERE h2.hotel_id = h.hotel_id) AS total_availability FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, b.total_price, (SELECT AVG(r.`ratings`.`Value`) FROM reviews r WHERE r.user_id = b.user_id) AS avg_value_rating FROM bookings b UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS booked_rooms WHERE b.payment_status = 'Paid';
SELECT h.name, (SELECT AVG(rt2.price) FROM hotel h2 UNNEST h2.room_types AS rt2 WHERE h2.hotel_id = h.hotel_id AND rt2.availability > 0) AS avg_price FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT h.name, (SELECT MAX(rt_inner.price) FROM hotel h2 UNNEST h2.room_types AS rt_inner WHERE h2.hotel_id = h.hotel_id) AS max_price FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT h.name, (SELECT AVG(rt_inner.price) FROM hotel h2 UNNEST h2.room_types AS rt_inner WHERE h2.hotel_id = h.hotel_id AND rt_inner.availability > 0) AS avg_price FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT b.booking_id, (SELECT AVG(r.ratings.`Value`) FROM reviews r WHERE r.user_id = b.user_id) AS avg_value_rating FROM bookings b UNNEST (SELECT RAW rt.name FROM hotel h UNNEST h.room_types AS rt WHERE h.hotel_id = b.hotel_id) AS booked_rooms WHERE b.payment_status = 'Paid';
SELECT h.name, (SELECT AVG(rt_inner.price) FROM hotel h2 UNNEST h2.room_types AS rt_inner WHERE h2.hotel_id = h.hotel_id AND rt_inner.availability > 0) AS avg_price FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;
SELECT h.name, (SELECT MAX(rt_inner.price) FROM hotel h2 UNNEST h2.room_types AS rt_inner WHERE h2.hotel_id = h.hotel_id) AS max_price FROM hotel h UNNEST h.room_types AS rt WHERE rt.availability > 0;